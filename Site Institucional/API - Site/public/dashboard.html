<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SafeTherm - Dashboard especifica</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="css/dashboards.css" />
  <link rel="stylesheet" href="assets/post-no-bills-jaffna-cufonfonts-webfont/style.css" />
</head>

<body>
  <!-- Fazer menu após concluir o backend -->
  <div class="menu">
    <div class="box-nav-logo">
      <a href="index.html">
        <h1><img src="assets/img/logo.png" />Safe <span>Therm</span></h1>
      </a>
    </div>
    <div class="icon_barra">
      <a href="dashboard-geral.html">
        <img src="assets/img/icon_dashboard.svg" alt="" />
        HOME
      </a>
    </div>
    <div class="icon_barra">
      <a href="dashboard-tela-funcionarios.html">
        <img src="assets/img/icon_listaFunc.svg" alt="" />
        FUNCIONÁRIOS
      </a>
    </div>
    <div class="icon_barra">
      <a href="dashboard-tela-veiculo.html">
        <img src="assets/img/icon_veiculo.svg" alt="" />
        VEÍCULOS
      </a>
    </div>
    <div class="icon_barra">
      <a href="https://sptech-safetherm.atlassian.net/servicedesk/customer/portal/1">
        <img src="assets/img/icon_suporte.svg" alt="" />
        SUPORTE
      </a>
    </div>
    <div class="icon_barra_sair">
      <button onclick="sair()">
        <img src="assets/img/icon_sair.svg" alt="" />
        SAIR
      </button>
    </div>
  </div>

  <section class="conteudo">
    <header>
      <div class="user_perfil" id="user_perfil">
        <button class="selectUser" onclick="abrirLogout()" id="btnLogout"></button>
        <div id="divLogout">
          <a href="">Funcionários</a>
          <a href="">Veículos</a>
          <button onclick="">SAIR</button>
        </div>
        <div id="infos_user">
          <h3>Roberta Silva</h3>
          <h4>roberta@therm.com</h4>
        </div>
        <img
          src="https://lenscope.com.br/blog/wp-content/uploads/2022/06/w24-Tipos-de-rosto_-os-formatos-de-rosto-que-existem-e-como-identificar-o-seu.png"
          alt="" />
      </div>
    </header>

    <div class="graficosGerados">
      <div class="infosMotorista" id="infosMotorista">
        <img
          src="https://lenscope.com.br/blog/wp-content/uploads/2022/06/w24-Tipos-de-rosto_-os-formatos-de-rosto-que-existem-e-como-identificar-o-seu.png"
          alt="" />
        <div class="motoristaInfo">
          <h1>MOTORISTA: <span>Fabiano Gomes dos Santos Oliveira</span></h1>
          <h1>TELEFONE: <span>(11) 00000-0000</span></h1>
          <h1>EMAIL: <span>fabiano.gomes@safetherm.com.br</span></h1>
        </div>
        <div class="caminhao">
          <h1>VEICULO</h1>
          <h1>MODELO: <span>Fiat Ducato</span></h1>
          <h1>PLACA: <span>ABC1D23</span></h1>
        </div>
      </div>
      <div class="conteudoGrafico">
        <div class="cardsEsquerda">
          <div class="card" id="realUmidade">
            <h1 id="titleReal">Média Umidade:</h1>
            <div class="circleAtivo"></div>
            <h1 id="dadosTempoRealUmi"></h1>
            <h3>Status: <span id="statusTempoRealUmi"></span></h3>
          </div>
          <div class="card" id="cincoUmidade">
            <div class="circleDesativo"></div>
            <h1 id="titleReal">Média Umidade:</h1>
            <h1 id="dadosTempoCincoUmi"></h1>
            <h3>Status: <span id="statusTempoCincoUmi"></span></h3>
          </div>
          <div class="card" id="dezUmidade">
            <div class="circleDesativo"></div>
          </div>

          <!-- definição para cards de temperatura inferiores na Esquerda -->
          <div class="card" id="realTemperaturaE">
            <div class="circleAtivo"></div>
          </div>
          <div class="card" id="cincoTemperaturaE">
            <div class="circleDesativo"></div>
          </div>
          <div class="card" id="dezTemperaturaE">
            <div class="circleDesativo"></div>
          </div>
        </div>
        <div class="graficArea">
          <div class="boxSelects">
            <select name="sel" id="selecaoMedia" class="selecaoMedia" onchange="selectDaMedia()">
              <option>Qual tempo deseja?</option>
              <option value="real">Dados em tempo real</option>
              <option value="cincoMin">Dados nos ultímos 5min</option>
              <!-- <option value="dezMin">Dados nos ultímos 10min</option> -->
            </select>
            <select name="sel" id="gaficosSelect" onchange="selecionarGrafico()" class="selecaoSensores">
              <option>Quais gráficos deseja?</option>
              <option value="Sup">Todos os Sensores Superiores</option>
              <option value="Umi">Apenas sensores de Umidade</option>
              <option value="Inf">Todos os Sensores Inferiores</option>
              <option value="Temp">Apenas sensores de Temperatura</option>
              <option value="Todos">Todos os Sensores</option>
            </select>
          </div>

          <div class="graficos" id="umidadeSuperior">
            <h3 class="statusCard">
              Umidade superior <span id="statusUmiSup">(Ativo)</span>
            </h3>
            <canvas id="myUmidadeSup" class="graficoEstilo"></canvas>
            <h1 id="infoUmiSup" style="
                  color: rgb(153, 153, 153);
                  z-index: 20;
                  position: absolute;
                  text-align: center;
                  width: 100%;
                  left: 0;
                ">
              NENHUM DADO SENDO CAPTURADO
            </h1>
            <h1 class="funcionamento">
              captura de dados:
              <span id="funcionamentoUmiSup">nenhum parâmetro</span>
            </h1>
          </div>
          <div class="graficos" id="umidadeInferior">
            <h3 class="statusCard">
              Umidade inferior <span id="statusUmiInf">(Ativo)</span>
            </h3>
            <canvas id="myUmidadeInf" class="graficoEstilo"></canvas>
            <h1 id="infoUmiInf" style="
                  color: rgb(153, 153, 153);
                  z-index: 20;
                  position: absolute;
                  text-align: center;
                  width: 100%;
                  left: 0;
                ">
              NENHUM DADO SENDO CAPTURADO
            </h1>
            <h1 class="funcionamento">
              captura de dados:
              <span id="funcionamentoUmiInf">nenhum parâmetro</span>
            </h1>
          </div>
          <div class="graficos" id="temperaturaSuperior">
            <h3 class="statusCard">
              Temperatura superior <span id="statusTempSup">(Ativo)</span>
            </h3>
            <canvas id="myTemperaturaSup" class="graficoEstilo"></canvas>
            <h1 id="infoTempSup" style="
                  color: rgb(153, 153, 153);
                  z-index: 20;
                  position: absolute;
                  text-align: center;
                  width: 100%;
                  left: 0;
                ">
              NENHUM DADO SENDO CAPTURADO
            </h1>
            <h1 class="funcionamento">
              captura de dados:
              <span id="funcionamentoTempSup">nenhum parâmetro</span>
            </h1>
          </div>
          <div class="graficos" id="temperaturaInferior">
            <h3 class="statusCard">
              Temperatura inferior
              <span id="statusTempInf">(Ativo)</span>
            </h3>
            <canvas id="myTemperaturaInf" class="graficoEstilo"></canvas>
            <h1 id="infoTempInf" style="
                  color: rgb(153, 153, 153);
                  z-index: 20;
                  position: absolute;
                  text-align: center;
                  width: 100%;
                  left: 0;
                ">
              NENHUM DADO SENDO CAPTURADO
            </h1>
            <h1 class="funcionamento">
              captura de dados:
              <span id="funcionamentoTempInf">nenhum parâmetro</span>
            </h1>
          </div>
        </div>

        <div class="cardsDireita">
          <div class="card" id="realTemperatura">
            <div class="circleAtivo"></div>
            <h1 id="titleReal">Média Temperatura:</h1>
            <div class="circleAtivo"></div>
            <h1 id="dadosTempoRealTemp"></h1>
            <h3>Status: <span id="statusTempoRealTemp"></span></h3>
          </div>
          <div class="card" id="cincoTemperatura">
            <div class="circleDesativo"></div>
            <h1 id="titleReal">Média Temperatura 5min:</h1>
            <h1 id="dadosTempoCinco"></h1>
            <h3>Status: <span id="statusTempoRealTempCinco"></span></h3>
          </div>
          <div class="card" id="dezTemperatura">
            <div class="circleDesativo"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="conteudoHistorico">
      <button onclick="abrirHitorico()" id="btnHistorico">
        abrir historico
      </button>
      <div class="boxHistorico" id="historicoSensor">
        <div class="topoTitulos">
          <h1>Data/hora</h1>
          <h1>Temperatura</h1>
          <h1>Umidade</h1>
          <h1>Veículo</h1>
          <h1>Status</h1>
        </div>
        <div class="scroll" id="listaDadosAlertas">
          <!-- <div class="listarDados">
            <h3>08/05/2025, 22:31</h3>
            <h3>5.6ºC</h3>
            <h3>50%</h3>
            <h3>ABC1D23</h3>
            <h3>Alerta</h3>
          </div> -->
        </div>
      </div>
    </div>
  </section>
</body>

</html>
<script>
  var idUsuario = sessionStorage.ID_SELECAO_FUNCIONARIO;
  var nomeUsuario = sessionStorage.NOME_USUARIO;
  var emailUsuario = sessionStorage.EMAIL_USUARIO;
  var fotoPerfil = sessionStorage.FOTO_PERFIL;

  // cards exibindo normalmente
  realTemperatura.style.display = "flex";
  realUmidade.style.display = "flex";

  // formatando usuario logado | usuario em sessão

  window.onload = function () {
    user_perfil.innerHTML = `
      <button
            class="selectUser"
            onclick="abrirLogout()"
            id="btnLogout"
          ></button>
          <div id="divLogout">
            <a href="">Funcionários</a>
            <a href="">Veículos</a>
            <button onclick="">SAIR</button>
          </div>
          <div id="infos_user">
            <h3>${nomeUsuario}</h3>
            <h4>${emailUsuario}</h4>
          </div>
          <img
            src="${fotoPerfil}"
            alt=""
          />
    `;

    informacoesUser();
    sensoresHistorico();
  };

  // function funional.

  function informacoesUser() {
    fetch(`/dashboardUser/infosUser/${idUsuario}`)
      .then((res) => res.json())
      .then((funcionario) => {
        const funcionarioSelect = funcionario[0];

        const nome = funcionarioSelect.nomeFuncionario;
        const email = funcionarioSelect.emailFuncionario;
        const tel = funcionarioSelect.telefoneFuncionario;
        const placa = funcionarioSelect.placaVeiculo;
        const modelo = funcionarioSelect.modelo;

        infosMotorista.innerHTML = `
           <img
              src="https://lenscope.com.br/blog/wp-content/uploads/2022/06/w24-Tipos-de-rosto_-os-formatos-de-rosto-que-existem-e-como-identificar-o-seu.png"
              alt=""
            />
            <div class="motoristaInfo">
              <h1>MOTORISTA: <span>${nome}</span></h1>
              <h1>TELEFONE: <span>${tel}</span></h1>
              <h1>EMAIL: <span>${email}</span></h1>
            </div>
            <div class="caminhao">
              <h1>VEICULO</h1>
              <h1>MODELO: <span>${modelo}</span></h1>
              <h1>PLACA: <span>${placa}</span></h1>
            </div>
          `;
      });
  }

  // dados sendo puxados necessário organização do banco de dados e criação de função.

  // inserir esse setInterval quando os graficos estiverem funcionando!
  // assim será possivel validar o historico sempre q a temperatura ultrapassar emitindo assim um alerta também!
  // na dashboard especifica.

  // setInterval(() => {
  //   sensoresHistorico();
  // }, 2000);
  idVeiculo = sessionStorage.ID_SELECAO_VEICULO;
  console.log(idVeiculo);

  function sensoresHistorico() {
    listaDadosAlertas.innerHTML = "";
    fetch(`/dashboardUser/umidadeHistorico/${idVeiculo}`)
      .then((res) => res.json())
      .then((umidade) => {
        fetch(`/dashboardUser/temperaturaHistorico/${idVeiculo}`)
          .then((res) => res.json())
          .then((temperatura) => {
            for (let i = 0; i < umidade.length && temperatura.length; i++) {
              //formatando umidade dataHora
              const dataPartesUmidade = umidade[i].dataHora
                .split("T")[0]
                .split("-");
              const horaPartesUmidade = umidade[i].dataHora
                .split("T")[1]
                .split(":");
              const dataUmidade = `${dataPartesUmidade[2]}/${dataPartesUmidade[1]}/${dataPartesUmidade[0]}, ${horaPartesUmidade[0]}:${horaPartesUmidade[1]}`;

              //formatando temperatura dataHora
              const dataPartesTemperatura = temperatura[i].dataHora
                .split("T")[0]
                .split("-");
              const horaPartesTemperatura = temperatura[i].dataHora
                .split("T")[1]
                .split(":");
              const dataTemperatura = `${dataPartesTemperatura[2]}/${dataPartesTemperatura[1]}/${dataPartesTemperatura[0]}, ${horaPartesTemperatura[0]}:${horaPartesTemperatura[1]}`;

              if (umidade[i].valor > 70 || umidade[i].valor < 40) {
                listaDadosAlertas.innerHTML += `
              <div class="listarDados">
                <h3>${dataUmidade}</h3>
                <h3>${temperatura[i].valor.slice(0, 3)}ºC</h3>
                <h3 style="color: #FF0000">${parseInt(umidade[i].valor)}%</h3>
                <h3>${umidade[i].placaVeiculo}</h3>
                <h3 style="color: #FF0000">Alerta Umidade</h3>
              </div>
            `;
              } else if (
                (umidade[i].valor >= 40 && umidade[i].valor < 50) ||
                (umidade[i].valor > 60 && umidade[i].valor < 70)
              ) {
                listaDadosAlertas.innerHTML += `
              <div class="listarDados">
                <h3>${dataUmidade}</h3>
                <h3>${temperatura[i].valor.slice(0, 3)}ºC</h3>
                <h3 style="color: #F5CD28">${parseInt(umidade[i].valor)}%</h3>
                <h3>${umidade[i].placaVeiculo}</h3>
                <h3 style="color: #F5CD28">Atenção Umidade</h3>
              </div>
            `;
              }

              if (
                (temperatura[i].valor > 6 && temperatura[i].valor < 7) ||
                (temperatura[i].valor > 2 && temperatura[i].valor < 4)
              ) {
                listaDadosAlertas.innerHTML += `
              <div class="listarDados">
                <h3>${dataTemperatura}</h3>
                <h3 style="color: #F5CD28">${temperatura[i].valor.slice(
                  0,
                  3
                )}ºC</h3>
                <h3>${parseInt(umidade[i].valor)}%</h3>
                <h3>${umidade[i].placaVeiculo}</h3>
                <h3 style="color: #F5CD28">Atenção Temperatura</h3>
              </div>
              `;
              } else if (temperatura[i].valor < 2 && temperatura[i].valor > 7) {
                listaDadosAlertas.innerHTML += `
              <div class="listarDados">
                <h3>${dataTemperatura}</h3>
                <h3 style="color: #FF0000">${temperatura[i].valor.slice(
                  0,
                  3
                )}ºC</h3>
                <h3>${parseInt(umidade[i].valor)}%</h3>
                <h3>${umidade[i].placaVeiculo}</h3>
                <h3" style="color: #FF0000">Alerta Temperatura</h3>
              </div>
              `;
              }
            }
          });
      });
  }

  // logout usuario
  function abrirLogout() {
    btnLogout.classList.toggle("effeitoLogout");
    if (btnLogout.classList.contains("effeitoLogout")) {
      divLogout.style.display = "flex";
      divLogout.classList.add("animacaoUser");
    } else {
      divLogout.classList.remove("animacaoUser");
      divLogout.style.display = "none";
    }
  }

  // animação dos gráficos + cards 5min e 10min fazer o backend
  var selecaoGrafico = "";
  function selecionarGrafico() {
    let graficoSelecionado = gaficosSelect.value;
    selecaoGrafico = graficoSelecionado;
    console.log(selecaoGrafico);

    console.log("acesso graficos");
    if (graficoSelecionado == "Sup") {
      umidadeSuperior.style.display = "flex";
      temperaturaSuperior.style.display = "flex";
      umidadeInferior.style.display = "none";
      temperaturaInferior.style.display = "none";
    } else if (graficoSelecionado == "Inf") {
      umidadeInferior.style.display = "flex";
      temperaturaInferior.style.display = "flex";
      umidadeSuperior.style.display = "none";
      temperaturaSuperior.style.display = "none";
    } else if (graficoSelecionado == "Umi") {
      umidadeInferior.style.display = "flex";
      temperaturaInferior.style.display = "none";
      umidadeSuperior.style.display = "flex";
      temperaturaSuperior.style.display = "none";
    } else if (graficoSelecionado == "Temp") {
      umidadeInferior.style.display = "none";
      temperaturaInferior.style.display = "flex";
      umidadeSuperior.style.display = "none";
      temperaturaSuperior.style.display = "flex";
    } else if (graficoSelecionado == "Todos") {
      umidadeInferior.style.display = "flex";
      temperaturaInferior.style.display = "flex";
      umidadeSuperior.style.display = "flex";
      temperaturaSuperior.style.display = "flex";
    }
    selectDaMedia(selecaoGrafico);
  }
  function selectDaMedia(grafico) {
    let mediaSelecionada = selecaoMedia.value;
    var graficoSelect = selecaoGrafico;
    console.log("acesso cards" + graficoSelect);
    if (mediaSelecionada == "cincoMin" && graficoSelect == "Sup") {
      cincoUmidade.style.display = "flex";
      cincoTemperatura.style.display = "flex";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "dezMin" && graficoSelect == "Sup") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "flex";
      dezUmidade.style.display = "flex";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "real" && graficoSelect == "Sup") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "flex";
      realUmidade.style.display = "flex";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "cincoMin" && graficoSelect == "Inf") {
      cincoUmidade.style.display = "flex";
      cincoTemperatura.style.display = "flex";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "dezMin" && graficoSelect == "Inf") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "flex";
      dezUmidade.style.display = "flex";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "real" && graficoSelect == "Inf") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "flex";
      realUmidade.style.display = "flex";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "cincoMin" && graficoSelect == "Umi") {
      cincoUmidade.style.display = "flex";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "dezMin" && graficoSelect == "Umi") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "flex";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "real" && graficoSelect == "Umi") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "flex";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "cincoMin" && graficoSelect == "Temp") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "flex";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "dezMin" && graficoSelect == "Temp") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "flex";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "real" && graficoSelect == "Temp") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "flex";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "cincoMin" && graficoSelect == "Todos") {
      cincoUmidade.style.display = "flex";
      cincoTemperatura.style.display = "none";
      cincoTemperaturaE.style.display = "flex";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "dezMin" && graficoSelect == "Todos") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "none";
      dezTemperaturaE.style.display = "flex";
      dezUmidade.style.display = "flex";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
    } else if (mediaSelecionada == "real" && graficoSelect == "Todos") {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "none";
      realTemperaturaE.style.display = "flex";
      realUmidade.style.display = "flex";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    } else {
      cincoUmidade.style.display = "none";
      cincoTemperatura.style.display = "none";
      realTemperatura.style.display = "none";
      realUmidade.style.display = "none";
      dezTemperatura.style.display = "none";
      dezUmidade.style.display = "none";
      realTemperaturaE.style.display = "none";
      cincoTemperaturaE.style.display = "none";
      dezTemperaturaE.style.display = "none";
    }
  }

  // atualizando sensores
  setInterval(() => {
    verificarAtivacao();
    dadosContainerReal()
  }, 1000);

  let analisarAtivacao = [];
  let intervaloSensores = null;

  function verificarAtivacao() {
    fetch(`dashboardUser/capturaDosIds/${idVeiculo}`)
      .then(res => res.json())
      .then(idSensores => {
        let sensoresEncontrados = [];

        idSensores.forEach(sensor => {
          if (!sensoresEncontrados.includes(sensor.idSensor)) {
            sensoresEncontrados.push(sensor.idSensor);
          }
        });

        if (sensoresEncontrados.length > 0) {
          Promise.all(
            sensoresEncontrados.map(id =>
              fetch(`/dashboardUser/verificarRota/${id}`).then(res => res.json())
            )
          ).then(respostas => {
            analisarAtivacao = [];

            respostas.forEach(dadosCapturados => {
              if (dadosCapturados != 0) {
                analisarAtivacao.push("ligado");
              } else {
                analisarAtivacao.push("desligado");


              }
            });

            if (analisarAtivacao.includes("ligado")) {
              console.log("ligado");

              // Inicia intervalo apenas se ainda não estiver rodando
              if (!intervaloSensores) {
                realTemperatura.style.display = "flex";
                realUmidade.style.display = "flex";

                selecaoMedia.style.pointerEvents = "all";
                myUmidadeInf.style.display = "flex";
                myTemperaturaInf.style.display = "flex";
                myUmidadeSup.style.display = "flex";
                myTemperaturaSup.style.display = "flex";
                intervaloSensores = setInterval(() => {
                  temperaturaSupIds();
                  umidadeSupIds();
                  temperaturaInfIds();
                  umidadeInfIds();
                }, 1000);
              }
            } else {
              console.log("desligado");

              realTemperatura.style.display = "none";
              realUmidade.style.display = "none";

              selecaoMedia.style.pointerEvents = "none";







              infoTempSup.style.display = "block";
              statusTempSup.innerHTML = "(DESATIVADO)";
              statusTempSup.style.color = "#d9d9d9";
              myTemperaturaSup.style.display = "none";
              funcionamentoTempSup.style.color = "#d9d9d9";
              funcionamentoTempSup.innerHTML = `
                      nenhum parâmetro
                    `;


              infoUmiSup.style.display = "block";
              statusUmiSup.innerHTML = "(DESATIVADO)";
              statusUmiSup.style.color = "#d9d9d9";
              myUmidadeSup.style.display = "none";
              funcionamentoUmiSup.style.color = "#d9d9d9";
              funcionamentoUmiSup.innerHTML = `
                      nenhum parâmetro
                    `;


              infoTempInf.style.display = "block";
              statusTempInf.innerHTML = "(DESATIVADO)";
              statusTempInf.style.color = "#d9d9d9";
              myTemperaturaInf.style.display = "none";
              funcionamentoTempInf.style.color = "#d9d9d9";
              funcionamentoTempInf.innerHTML = `
                      nenhum parâmetro
                    `;


              infoUmiInf.style.display = "block";
              statusUmiInf.innerHTML = "(DESATIVADO)";
              statusUmiInf.style.color = "#d9d9d9";
              myUmidadeInf.style.display = "none";
              funcionamentoUmiInf.style.color = "#d9d9d9";
              funcionamentoUmiInf.innerHTML = `
                      nenhum parâmetro
                    `;

              // Para o intervalo se ele estiver ativo
              if (intervaloSensores) {
                clearInterval(intervaloSensores);
                intervaloSensores = null;
              }
            }
          });
        }
      })
      .catch(error => {
        console.error("Erro ao verificar ativação:", error);
      });
  }



  function dadosContainerReal() {
    fetch(`dashboardUser/containerUmidadeReal/${idVeiculo}`)
      .then(res => res.json())
      .then(umidadeTempoReal => {



        let valorFormatado = Number(umidadeTempoReal[0].media_valor)
        let valor = parseInt(valorFormatado)
        console.log(valor)

        dadosTempoRealUmi.innerHTML = valor + "%";

        if (
          (valor > 60 &&
            valor < 70) ||
          (valor >= 40 && valor < 50)
        ) {
          // console.log("atenção");
          statusTempoRealUmi.style.color = "##F5CD28"
          statusTempoRealUmi.innerHTML = "Atenção"
        }
        if (
          valor >= 50 &&
          valor <= 60
        ) {
          // ideal

          statusTempoRealUmi.style.color = "#067500"
          statusTempoRealUmi.innerHTML = "Seguro"

        }
        if (
          valor > 70 ||
          valor < 40
        ) {
          // console.log("Risco");
          // risco
          statusTempoRealUmi.style.color = "#FF0000"
          statusTempoRealUmi.innerHTML = "Risco"

        }

      });

    fetch(`dashboardUser/containerUmidadeCinco/${idVeiculo}`)
      .then(res => res.json())
      .then(umidadeTempoCinco => {



        let valorFormatadoCinco = Number(umidadeTempoCinco[0].media_valor)
        let valorCinco = parseInt(valorFormatadoCinco)
        console.log(valorCinco)

        dadosTempoCincoUmi.innerHTML = valorCinco + "%";

        if (
          (valorCinco > 60 &&
            valorCinco < 70) ||
          (valorCinco >= 40 && valorCinco < 50)
        ) {
          // console.log("atenção");
          statusTempoCincoUmi.style.color = "##F5CD28"
          statusTempoCincoUmi.innerHTML = "Atenção"
        }
        if (
          valorCinco >= 50 &&
          valorCinco <= 60
        ) {
          // ideal

          statusTempoCincoUmi.style.color = "#067500"
          statusTempoCincoUmi.innerHTML = "Seguro"

        }
        if (
          valorCinco > 70 ||
          valorCinco < 40
        ) {
          // console.log("Risco");
          // risco
          statusTempoCincoUmi.style.color = "#FF0000"
          statusTempoCincoUmi.innerHTML = "Risco"

        }

      });


    fetch(`dashboardUser/containerTeperaturaReal/${idVeiculo}`)
      .then(res => res.json())
      .then(temperaturaTempoReal => {



        let valorFormatadoTemp = Number(temperaturaTempoReal[0].media_valor)
        let valorTemp = parseInt(valorFormatadoTemp)
        console.log(valorTemp)

        dadosTempoRealTemp.innerHTML = valorTemp + "°C";

        if (
          (valorTemp > 6 &&
            valorTemp <= 7) ||
          (valorTemp >= 2 && valorTemp < 4)
        ) {
          // console.log("atenção");
          statusTempoRealTemp.style.color = "##F5CD28"
          statusTempoRealTemp.innerHTML = "Atenção"
        }
        if (
          valorTemp >= 4 &&
          valorTemp <= 6
        ) {
          // ideal

          statusTempoRealTemp.style.color = "#067500"
          statusTempoRealTemp.innerHTML = "Seguro"

        }
        if (
          valorTemp > 7 ||
          valorTemp < 2
        ) {
          // console.log("Risco");
          // risco
          statusTempoRealTemp.style.color = "#FF0000"
          statusTempoRealTemp.innerHTML = "Risco"

        }

      });


    fetch(`dashboardUser/containerTeperaturaCinco/${idVeiculo}`)
      .then(res => res.json())
      .then(containerTeperaturaCinco => {



        let valorFormatadoTempCinco = Number(containerTeperaturaCinco[0].media_valor)
        let valorTempCinco = parseInt(valorFormatadoTempCinco)
        console.log(valorTempCinco)

        dadosTempoCinco.innerHTML = valorTempCinco + "°C";

        if (
          (valorTempCinco > 6 &&
            valorTempCinco <= 7) ||
          (valorTempCinco >= 2 && valorTempCinco < 4)
        ) {
          // console.log("atenção");
          statusTempoRealTempCinco.style.color = "##F5CD28"
          statusTempoRealTempCinco.innerHTML = "Atenção"
        }
        if (
          valorTempCinco >= 4 &&
          valorTempCinco <= 6
        ) {
          // ideal

          statusTempoRealTempCinco.style.color = "#067500"
          statusTempoRealTempCinco.innerHTML = "Seguro"

        }
        if (
          valorTempCinco > 7 ||
          valorTempCinco < 2
        ) {
          // console.log("Risco");
          // risco
          statusTempoRealTempCinco.style.color = "#FF0000"
          statusTempoRealTempCinco.innerHTML = "Risco"

        }

      });
  }


  let chartTemperaturaSup = null;
  //function capturar ids e grafico temperatura Superior
  function temperaturaSupIds() {
    fetch(`dashboardUser/veiculoTemperatura/${idVeiculo}`)
      .then((res) => res.json())
      .then((temperatura) => {
        let sensoresEncontrados = [];
        for (let i = 0; i < temperatura.length; i++) {
          let idSensor = temperatura[i].idSensor;
          if (!sensoresEncontrados.includes(idSensor)) {
            sensoresEncontrados.push(idSensor);
          }
        }

        if (sensoresEncontrados.length == 0) {
          console.log(
            "Nenhum dado do sensor Temperatura Superior sendo capiturado!"
          );
          realTemperatura.style.display = "none";
          realUmidade.style.display = "none";
          infoTempSup.style.display = "block";
          statusTempSup.innerHTML = "(DESATIVADO)";
          statusTempSup.style.color = "#c9c9c9";
        } else {
          infoTempSup.style.display = "none";
          fetch(`dashboardUser/graficTempSup/${sensoresEncontrados[0]}`)
            .then((res) => res.json())
            .then((dadosTempSup) => {
              let listarDadosTempSup = [];
              let listarIntervalo = [];
              for (let i = dadosTempSup.length - 1; i >= 0; i--) {
                let horaMinuto = dadosTempSup[i].dataHora.slice(11, 19); // Pega da posição 11 até 16 -> "HH:MM"
                listarIntervalo.push(horaMinuto);
                listarDadosTempSup.push(dadosTempSup[i].valor);
              }

              fetch(`/dashboardUser/verificarCaptura/${sensoresEncontrados[0]}`)
                .then((res) => res.json())
                .then((dadosCapturados) => {
                  let idSensor = sensoresEncontrados[0];

                  if (dadosCapturados.length != 0) {
                    console.log("dados inseridos");
                    statusTempSup.innerHTML = "(Ativo)";
                    statusTempSup.style.color = "#067500";
                    if (
                      (listarDadosTempSup[5] > 6 &&
                        listarDadosTempSup[5] <= 7) ||
                      (listarDadosTempSup[5] >= 2 && listarDadosTempSup[5] < 4)
                    ) {
                      // console.log("atenção");
                      funcionamentoTempSup.style.color = "#F5CD28";
                      funcionamentoTempSup.innerHTML = `
                        Atenção
                        ${listarDadosTempSup[5].slice(0, 3)} ºC
                      `;
                    }
                    if (
                      listarDadosTempSup[5] >= 4 &&
                      listarDadosTempSup[5] <= 6
                    ) {
                      funcionamentoTempSup.style.color = "#067500";
                      funcionamentoTempSup.innerHTML = `
                        Ideal
                        ${listarDadosTempSup[5].slice(0, 3)} ºC
                      `;
                    }
                    if (
                      listarDadosTempSup[5] > 7 ||
                      listarDadosTempSup[5] < 2
                    ) {
                      // console.log("Risco");
                      funcionamentoTempSup.style.color = "#FF0000";
                      funcionamentoTempSup.innerHTML = `
                        Risco
                        ${listarDadosTempSup[5].slice(0, 3)} ºC
                      `;
                    }
                  } else {
                    statusTempSup.innerHTML = "(Manutenção)";
                    statusTempSup.style.color = "#ff472f";
                    funcionamentoTempSup.style.color = "#FF0000";
                    funcionamentoTempSup.innerHTML = `
                      COM DEFEITO
                    `;

                    fetch(`/dashboardUser/atualizandoStatus`, {
                      method: "POST",
                      headers: {
                        "Content-Type": "application/json",
                      },
                      body: JSON.stringify({
                        idSensorServer: idSensor,
                      }),
                    })
                      .then(function (resposta) {
                        if (resposta.ok) {
                          // console.log(
                          //   `Alteração do status do sensor concluída`
                          // );
                        } else {
                          throw "Erro ao alterar status do sensor";
                        }
                      })
                      .catch(function (resposta) {
                        console.log(`#ERRO: ${resposta}`);
                      });
                  }
                });

              // Grafico prontos para receber dados do banco após conclusão de historico.
              const temperaturaSup =
                document.getElementById("myTemperaturaSup");

              // Destroi o gráfico anterior
              if (chartTemperaturaSup) {
                chartTemperaturaSup.destroy();
              }

              // Criando novo gráfico
              chartTemperaturaSup = new Chart(temperaturaSup, {
                type: "line",
                data: {
                  labels: listarIntervalo,
                  datasets: [
                    {
                      label: "Temperatura - Superior",
                      data: listarDadosTempSup,
                      backgroundColor: "#FF7F00",
                      borderRadius: 8,
                      borderSkipped: false,
                      hoverBackgroundColor: "#333",
                      hoverBorderColor: "#333",
                    },
                  ],
                },
                options: {
                  maintainAspectRatio: false,
                  animation: false,
                  scales: {
                    y: {
                      beginAtZero: true,
                    },
                  },
                },
              });
            });
        }
      });
  }

  let chartUmidadeSup = null;
  //function capturar ids e grafico umidade Superior
  function umidadeSupIds() {
    fetch(`dashboardUser/veiculoUmidade/${idVeiculo}`)
      .then((res) => res.json())
      .then((umidade) => {
        let sensoresEncontrados = [];
        for (let i = 0; i < umidade.length; i++) {
          let idSensor = umidade[i].idSensor;
          if (!sensoresEncontrados.includes(idSensor)) {
            sensoresEncontrados.push(idSensor);
          }
        }

        if (sensoresEncontrados.length == 0) {
          realTemperatura.style.display = "flex";
          realUmidade.style.display = "flex";
          infoUmiSup.style.display = "block";
          statusUmiSup.innerHTML = "(DESATIVADO)";
          statusUmiSup.style.color = "#c9c9c9";
        } else {
          infoUmiSup.style.display = "none";
          fetch(`dashboardUser/graficUmiSup/${sensoresEncontrados[0]}`)
            .then((res) => res.json())
            .then((dadosUmiSup) => {
              let listarDadosUmiSup = [];
              let listarIntervalo = [];
              for (let i = dadosUmiSup.length - 1; i >= 0; i--) {
                let horaMinuto = dadosUmiSup[i].dataHora.slice(11, 19); // Pega da posição 11 até 16 -> "HH:MM"
                listarIntervalo.push(horaMinuto);
                listarDadosUmiSup.push(dadosUmiSup[i].valor);
              }

              // verificação se está tendo captura de dados / caso contrario entra em manutenção
              fetch(`/dashboardUser/verificarCaptura/${sensoresEncontrados[0]}`)
                .then((res) => res.json())
                .then((dadosCapturados) => {
                  idSensor = sensoresEncontrados[0];

                  if (dadosCapturados.length != 0) {
                    console.log("dados inseridos");
                    statusUmiSup.innerHTML = "(Ativo)";
                    statusUmiSup.style.color = "#067500";
                    if (
                      (listarDadosUmiSup[5] > 60 &&
                        listarDadosUmiSup[5] < 70) ||
                      (listarDadosUmiSup[5] >= 40 && listarDadosUmiSup[5] < 50)
                    ) {
                      // console.log("atenção");
                      funcionamentoUmiSup.style.color = "#F5CD28";
                      funcionamentoUmiSup.innerHTML = `
                        Atenção
                        ${listarDadosUmiSup[5].slice(0, 2)}%
                      `;
                    }
                    if (
                      listarDadosUmiSup[5] >= 50 &&
                      listarDadosUmiSup[5] <= 60
                    ) {
                      funcionamentoUmiSup.style.color = "#067500";
                      funcionamentoUmiSup.innerHTML = `
                        Ideal
                        ${listarDadosUmiSup[5].slice(0, 2)}%
                      `;
                    }
                    if (
                      listarDadosUmiSup[5] > 70 ||
                      listarDadosUmiSup[5] < 40
                    ) {
                      // console.log("Risco");
                      funcionamentoUmiSup.style.color = "#FF0000";
                      funcionamentoUmiSup.innerHTML = `
                        Risco
                        ${listarDadosUmiSup[5].slice(0, 2)}%
                      `;
                    }
                  } else {
                    statusUmiSup.innerHTML = "(Manutenção)";
                    statusUmiSup.style.color = "#ff472f";
                    funcionamentoUmiSup.style.color = "#FF0000";
                    funcionamentoUmiSup.innerHTML = `
                      COM DEFEITO
                    `;
                  }

                  fetch(`/dashboardUser/atualizandoStatus`, {
                    method: "POST",
                    headers: {
                      "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                      idSensorServer: idSensor,
                    }),
                  })
                    .then(function (resposta) {
                      if (resposta.ok) {
                        // console.log(`Alteração do status do sensor concluída`);
                      } else {
                        throw "Erro ao alterar status do sensor";
                      }
                    })
                    .catch(function (resposta) {
                      console.log(`#ERRO: ${resposta}`);
                    });
                });

              // Grafico prontos para receber dados do banco após conclusão de historico.
              const umidadeSup = document.getElementById("myUmidadeSup");
              // Destroi o gráfico anterior
              if (chartUmidadeSup) {
                chartUmidadeSup.destroy();
              }
              chartUmidadeSup = new Chart(umidadeSup, {
                type: "line",
                data: {
                  labels: listarIntervalo,
                  datasets: [
                    {
                      label: "Umidade - Superior",
                      data: listarDadosUmiSup,
                      backgroundColor: "#00bfff",
                      borderRadius: 8,
                      borderSkipped: false,
                      hoverBackgroundColor: "#333",
                      hoverBorderColor: "#333",
                    },
                  ],
                },
                options: {
                  maintainAspectRatio: false,
                  animation: false,
                  scales: {
                    y: {
                      beginAtZero: true,
                    },
                  },
                },
              });
            });
        }
      });
  }

  let chartTemperaturaInf = null;
  //function capturar ids e grafico temperatura Inferior
  function temperaturaInfIds() {
    fetch(`dashboardUser/veiculoTemperatura/${idVeiculo}`)
      .then((res) => res.json())
      .then((temperatura) => {
        let sensoresEncontrados = [];
        for (let i = 0; i < temperatura.length; i++) {
          let idSensor = temperatura[i].idSensor;
          if (!sensoresEncontrados.includes(idSensor)) {
            sensoresEncontrados.push(idSensor);
          }
        }

        if (!sensoresEncontrados[1]) {
          realTemperatura.style.display = "none";
          realUmidade.style.display = "none";
          infoTempInf.style.display = "block";
          statusTempInf.innerHTML = "(DESATIVADO)";
          statusTempInf.style.color = "#c9c9c9";
        } else {
          infoTempInf.style.display = "none";
          // Valores encontrados por que eu sou muito bom.
          fetch(`dashboardUser/graficTempInf/${sensoresEncontrados[1]}`)
            .then((res) => res.json())
            .then((dadosTempInf) => {
              let listarDadosTempInf = [];
              let listarIntervalo = [];
              for (let i = dadosTempInf.length - 1; i >= 0; i--) {
                let horaMinuto = dadosTempInf[i].dataHora.slice(11, 19); // Pega da posição 11 até 16 -> "HH:MM"
                listarIntervalo.push(horaMinuto);
                listarDadosTempInf.push(dadosTempInf[i].valor);
              }

              fetch(`/dashboardUser/verificarCaptura/${sensoresEncontrados[1]}`)
                .then((res) => res.json())
                .then((dadosCapturados) => {
                  idSensor = sensoresEncontrados[1];
                  console.log(dadosCapturados);
                  if (dadosCapturados.length != 0) {
                    console.log("dados inseridos");
                    statusTempInf.innerHTML = "(Ativo)";
                    statusTempInf.style.color = "#067500";
                    if (
                      (listarDadosTempInf[5] > 6 &&
                        listarDadosTempInf[5] <= 7) ||
                      (listarDadosTempInf[5] >= 2 && listarDadosTempInf[5] < 4)
                    ) {
                      // console.log("atenção");
                      funcionamentoTempInf.style.color = "#F5CD28";
                      funcionamentoTempInf.innerHTML = `
                        Atenção
                        ${listarDadosTempInf[5].slice(0, 3)} ºC
                      `;
                    }
                    if (
                      listarDadosTempInf[5] >= 4 &&
                      listarDadosTempInf[5] <= 6
                    ) {
                      funcionamentoTempInf.style.color = "#067500";
                      funcionamentoTempInf.innerHTML = `
                        Ideal
                        ${listarDadosTempInf[5].slice(0, 3)} ºC
                      `;
                    }
                    if (
                      listarDadosTempInf[5] > 7 ||
                      listarDadosTempInf[5] < 2
                    ) {
                      // console.log("Risco");
                      funcionamentoTempInf.style.color = "#FF0000";
                      funcionamentoTempInf.innerHTML = `
                        Risco
                        ${listarDadosTempInf[5].slice(0, 3)} ºC
                      `;
                    }
                  } else {
                    statusTempInf.innerHTML = "(Manutenção)";
                    statusTempInf.style.color = "#ff472f";
                    funcionamentoTempInf.style.color = "#FF0000";
                    funcionamentoTempInf.innerHTML = `
                      COM DEFEITO
                    `;

                    fetch(`/dashboardUser/atualizandoStatus`, {
                      method: "POST",
                      headers: {
                        "Content-Type": "application/json",
                      },
                      body: JSON.stringify({
                        idSensorServer: idSensor,
                      }),
                    })
                      .then(function (resposta) {
                        if (resposta.ok) {
                          // console.log(
                          //   `Alteração do status do sensor concluída`
                          // );
                        } else {
                          throw "Erro ao alterar status do sensor";
                        }
                      })
                      .catch(function (resposta) {
                        console.log(`#ERRO: ${resposta}`);
                      });
                  }
                });

              // Grafico prontos para receber dados do banco após conclusão de historico.
              const temperaturaInf =
                document.getElementById("myTemperaturaInf");

              // Destroi o gráfico anterior
              if (chartTemperaturaInf) {
                chartTemperaturaInf.destroy();
              }
              chartTemperaturaInf = new Chart(temperaturaInf, {
                type: "line",
                data: {
                  labels: listarIntervalo,
                  datasets: [
                    {
                      label: "Temperatura - Inferior",
                      data: listarDadosTempInf,
                      backgroundColor: "#FF7F00",
                      borderRadius: 8,
                      borderSkipped: false,
                      hoverBackgroundColor: "#333",
                      hoverBorderColor: "#333",
                    },
                  ],
                },
                options: {
                  maintainAspectRatio: false,
                  animation: false,
                  scales: {
                    y: {
                      beginAtZero: true,
                    },
                  },
                },
              });
            });
        }
      });
  }

  let chartUmidadeInf = null;
  //function capturar ids e grafico umidade Inferior
  function umidadeInfIds() {
    fetch(`dashboardUser/veiculoUmidade/${idVeiculo}`)
      .then((res) => res.json())
      .then((umidade) => {
        let sensoresEncontrados = [];
        for (let i = 0; i < umidade.length; i++) {
          let idSensor = umidade[i].idSensor;
          if (!sensoresEncontrados.includes(idSensor)) {
            sensoresEncontrados.push(idSensor);
          }
        }

        if (!sensoresEncontrados[1]) {
          console.log(
            "Nenhum dado do sensor Umidade Inferior sendo capiturado!"
          );
          realTemperatura.style.display = "none";
          realUmidade.style.display = "none";
          infoUmiInf.style.display = "block";
          statusUmiInf.innerHTML = "(DESATIVADO)";
          statusUmiInf.style.color = "#c9c9c9";
        } else {
          infoUmiInf.style.display = "none";
          fetch(`dashboardUser/graficUmiInf/${sensoresEncontrados[1]}`)
            .then((res) => res.json())
            .then((dadosUmiInf) => {
              let listarDadosUmiInf = [];
              let listarIntervalo = [];
              for (let i = dadosUmiInf.length - 1; i >= 0; i--) {
                let horaMinuto = dadosUmiInf[i].dataHora.slice(11, 19); // Pega da posição 11 até 16 -> "HH:MM"
                listarIntervalo.push(horaMinuto);
                listarDadosUmiInf.push(dadosUmiInf[i].valor);
              }

              fetch(`/dashboardUser/verificarCaptura/${sensoresEncontrados[1]}`)
                .then((res) => res.json())
                .then((dadosCapturados) => {
                  idSensor = sensoresEncontrados[1];
                  console.log(dadosCapturados);
                  if (dadosCapturados.length != 0) {
                    console.log("dados inseridos");
                    statusUmiInf.innerHTML = "(Ativo)";
                    statusUmiInf.style.color = "#067500";
                    if (
                      (listarDadosUmiInf[5] > 60 &&
                        listarDadosUmiInf[5] < 70) ||
                      (listarDadosUmiInf[5] >= 40 && listarDadosUmiInf[5] < 50)
                    ) {
                      // console.log("atenção");
                      funcionamentoUmiInf.style.color = "#F5CD28";
                      funcionamentoUmiInf.innerHTML = `
                        Atenção
                        ${listarDadosUmiInf[5].slice(0, 2)}%
                      `;
                    }
                    if (
                      listarDadosUmiInf[5] >= 50 &&
                      listarDadosUmiInf[5] <= 60
                    ) {
                      funcionamentoUmiInf.style.color = "#067500";
                      funcionamentoUmiInf.innerHTML = `
                        Ideal
                        ${listarDadosUmiInf[5].slice(0, 2)}%
                      `;
                    }
                    if (
                      listarDadosUmiInf[5] > 70 ||
                      listarDadosUmiInf[5] < 40
                    ) {
                      // console.log("Risco");
                      funcionamentoUmiInf.style.color = "#FF0000";
                      funcionamentoUmiInf.innerHTML = `
                        Risco
                        ${listarDadosUmiInf[5].slice(0, 2)}%
                      `;
                    }
                  } else {
                    // console.log("sem dados umidade Inferior sendo capturados.");
                    statusUmiInf.innerHTML = "(Manutenção)";
                    statusUmiInf.style.color = "#ff472f";
                    funcionamentoUmiInf.style.color = "#FF0000";
                    funcionamentoUmiInf.innerHTML = `
                      COM DEFEITO
                    `;

                    fetch(`/dashboardUser/atualizandoStatus`, {
                      method: "POST",
                      headers: {
                        "Content-Type": "application/json",
                      },
                      body: JSON.stringify({
                        idSensorServer: idSensor,
                      }),
                    })
                      .then(function (resposta) {
                        if (resposta.ok) {
                          // console.log(
                          //   `Alteração do status do sensor concluída`
                          // );
                        } else {
                          throw "Erro ao alterar status do sensor";
                        }
                      })
                      .catch(function (resposta) {
                        console.log(`#ERRO: ${resposta}`);
                      });
                  }
                });

              // Grafico prontos para receber dados do banco após conclusão de historico.
              const umidadeInf = document.getElementById("myUmidadeInf");
              // Destroi o gráfico anterior
              if (chartUmidadeInf) {
                chartUmidadeInf.destroy();
              }
              chartUmidadeInf = new Chart(umidadeInf, {
                type: "line",
                data: {
                  labels: listarIntervalo,
                  datasets: [
                    {
                      label: "Umidade - Inferior",
                      data: listarDadosUmiInf,
                      backgroundColor: "#00bfff",
                      borderRadius: 8,
                      borderSkipped: false,
                      hoverBackgroundColor: "#333",
                      hoverBorderColor: "#333",
                    },
                  ],
                },
                options: {
                  maintainAspectRatio: false,
                  animation: false,
                  scales: {
                    y: {
                      beginAtZero: true,
                    },
                  },
                },
              });
            });
        }
      });
  }

  //abrir historico para visualizar notificações de alertas
  function abrirHitorico() {
    const clicado = document.getElementById("historicoSensor");
    clicado.classList.toggle("adicionar");
    sensoresHistorico()
  }
</script>
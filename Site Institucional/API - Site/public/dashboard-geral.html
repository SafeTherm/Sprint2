<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/dashboards-geral.css">
    <link rel="stylesheet" href="assets/post-no-bills-jaffna-cufonfonts-webfont/style.css">
</head>

<body>
    <div class="menu">
        <div class="logo">
            <img src="" alt="">
        </div>
    </div>


    <section class="conteudo">
        <header>
            <div class="box-nav-logo">
                <a href="index.html">
                    <h1><img src="assets/img/logo.png">Safe <span>Therm</span></h1>
                </a>
            </div>
            <div class="pesquisar-placa">
                <input type="text" id="input_placa" placeholder="pesquisar funcionario/placa..."
                    oninput="pesquisaFunc()">
                <div>
                    <img src="assets/img/lupa.svg" alt="">
                </div>


                <!-- essa div é display none, com o oninput ela aparece -->
                <div class="resultado_pesquisa" style="display: none;" id="div_resultado_pesquisa">


                    <!-- div com += -->
                    <div class="info_funcionarios">
                        <img src="" alt="">
                        <div class="informacoes_func">
                            <div class="nome">
                                nome do funcionario
                            </div>
                            <div class="info_veiculo">
                                <div class="placa">
                                    veículo: CXPT-2EW3
                                </div>
                                <div class="tipo_veiculo">
                                    caminhão: Fiat Ducato
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="user_perfil" id="div_userPerfil">
                <div id="infos-user">
                    <h3>Roberta Silva</h3>
                    <h4>roberta@therm.com</h4>
                </div>
                <img src="assets/imagens de perfil/perfil_anonimo.jpeg" alt="">
            </div>
        </header>

        <div class="cards">

            <div class="card-notificacao">
                <div class="titulo">
                    Notificações recentes
                </div>
                <div class="alerta_exibir">
                    <div class="notificacao-alerta">
                        <div class="alerta_img">
                            <img src="assets/img/alerta_vermelho.svg" alt="">
                        </div>
                        <div class="alerta_info">
                            <div class="status_alerta">
                                Temperatura fora dos limites
                            </div>
                            <div class="alerta_veiculo">
                                Placa veículo: ABC1D23
                            </div>
                            <div class="alerta_data">
                                08/05/2025, 22:11
                            </div>
                        </div>
                    </div>
                </div>

            </div>


            <div class="card-notificacao">
                <div class="titulo">
                    Falhas nos sensores
                </div>
                <div class="alerta_exibirSensor" id="div_alerta_exibirSensor">


                    <div class="notificacao-alertaSensor">
                        <div class="statusSensor">
                            <div class="bolinha_status"></div>
                            <div class="status">
                                ATIVO
                            </div>
                        </div>

                        <div class="infoSensor1">
                            <div class="sensor_imgFunc">
                                <img src="" alt="">
                            </div>
                            <div class="subInfoSensor">
                                <div class="sensorNomeFunc">
                                    nome do funcionario
                                </div>
                                <div class="sensorVeiculo">
                                    veículo: CXPT-2EW3
                                </div>
                                <div class="sensorVeiculoTipo">
                                    caminhão: Fiat Ducato
                                </div>
                            </div>
                        </div>

                        <div class="infoSensor2">

                            <div class="sensorStatus">
                                STATUS: Exige manutenção
                            </div>
                            <div class="infoSensor3">
                                <div class="subInfoSensor1">
                                    <div>
                                        Umidade superior
                                    </div>
                                    <div>
                                        Umidade inferior
                                    </div>
                                    <div>
                                        Temperatura superior
                                    </div>
                                    <div>
                                        Temperatura inferior
                                    </div>
                                </div>

                                <div class="botaoChamado">
                                    <button onclick="chamado()">
                                        chamado
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>


























            <div class="card-notificacaoFrota">
                <div class="titulo_frota">
                    Status da frota
                    <div class="frotaImg">
                        <img src="assets/img/frotaIcon.svg" alt="">
                    </div>

                </div>

                <div class="frota_exibir" id="div_cardFrota">

                    <div>
                        Total: 30
                    </div>
                    <div>
                        Em rota: 10
                    </div>
                    <div>
                        Alertas: 0
                    </div>
                </div>

                <div class="frotaStatus">
                    Atenção necessária
                    <img src="assets/img/alerta_amarelo.svg" alt="">
                </div>




            </div>

        </div>

        <div class="veiculosEmpresa">
            <div class="tituloVeiculoEmpresa">
                VEÍCULOS DA EMPRESA
            </div>
            <div class="exibirCards">

                <div class="cardVeiculos">
                    <div class="front">
                        <div class="statusVeiculo">
                            <div class="bolinha_status"></div>
                            <div class="status">
                                ATIVO
                            </div>
                        </div>

                        <div class="infoVeiculo1">
                            <div class="Veiculo_imgFunc">
                                <img src="" alt="">
                            </div>
                            <div class="subInfoVeiculo">
                                <div class="VeiculoNomeFunc">
                                    nome do funcionario
                                </div>
                                <div class="Veiculo">
                                    veículo: CXPT-2EW3
                                </div>
                                <div class="VeiculoTipo">
                                    caminhão: Fiat Ducato
                                </div>
                            </div>
                        </div>

                        <div class="infoVeiculo2">
                            <div>
                                media temperatura:
                            </div>
                            <div>
                                media umidade:
                            </div>
                        </div>
                    </div>

                    <div class="back">
                        <div class="statusVeiculo">
                            <div class="bolinha_status"></div>
                            <div class="status">
                                ATIVO
                            </div>
                        </div>

                        <div class="infoVeiculo1">
                            <div class="Veiculo_imgFunc">
                                <img src="" alt="">
                            </div>
                            <div class="subInfoVeiculo">
                                <div class="VeiculoNomeFunc">
                                    nome do funcionario
                                </div>
                                <div class="Veiculo">
                                    veículo: CXPT-2EW3
                                </div>
                                <div class="VeiculoTipo">
                                    caminhão: Fiat Ducato
                                </div>
                            </div>
                        </div>

                        <div class="infoVeiculo2">
                            <div class="botao_acessar">
                                <button onclick="acessar()">
                                    acessar
                                </button>
                            </div>
                        </div>

                    </div>













                </div>
            </div>
        </div>
    </section>
</body>

</html>

<script>
    var idUsuario = sessionStorage.ID_USUARIO
    var nomeUsuario = sessionStorage.NOME_USUARIO
    var emailUsuario = sessionStorage.EMAIL_USUARIO
    var fotoPerfil = sessionStorage.FOTO_PERFIL

    window.onload = function () {

        console.log(nomeUsuario)
        div_userPerfil.innerHTML = `
            <div id="infos-user">
                <h3>${nomeUsuario}</h3>
                <h4>${emailUsuario}</h4>
            </div>
            <img src="assets/imagens de perfil/${fotoPerfil}" alt="">`


        listarFrota()
        alertaSensor()
    }

    function listarFrota() {
        fetch(`dashboard/listarFrota/${idUsuario}`)
            .then(res => res.json())
            .then(qtdVeiculos => {
                console.log(qtdVeiculos[0])
                var qtd = qtdVeiculos[0].qtdVeiculo

                div_cardFrota.innerHTML = `
                <div>
                    Total: ${qtd}
                </div>`

                fetch(`dashboard/listarVeiculosEmRota/${idUsuario}`)
                    .then(res => res.json())
                    .then(qtdVeiculosRota => {

                        var veiculosEmRota = qtdVeiculosRota[0].veiculosEmRota

                        console.log(veiculosEmRota)

                        div_cardFrota.innerHTML += `
                    <div>
                        Em rota: ${veiculosEmRota}
                    </div>`
                    })
            })












    }

    function pesquisaFunc() {
        var conteudo_pesquisa = input_placa.value

        if (conteudo_pesquisa === "") {
            div_resultado_pesquisa.style.display = "none"
        } else {
            div_resultado_pesquisa.style.display = "flex"

            fetch(`dashboard/barraPesquisa/${idUsuario}/${conteudo_pesquisa}`)
                .then(res => res.json())
                .then(dados_pesquisa => {

                    div_resultado_pesquisa.innerHTML = ""

                    for (let i = 0; i < dados_pesquisa.length; i++) {
                        let dados = dados_pesquisa[i]

                        var imagemFunc = dados.imagemPerfil_funcionario
                        var idFuncionario = dados.idFuncionario
                        var nomeFuncionario = dados.nomeFuncionario
                        var idVeiculo = dados.idVeiculo
                        var placaVeiculo = dados.placaVeiculo
                        var modeloVeiculo = dados.modelo

                        div_resultado_pesquisa.innerHTML += `
                        <div class="info_funcionarios">
                        <img src="assets/imagens de perfil/${imagemFunc}" alt="">
                        <div class="informacoes_func">
                            <div class="nome">
                                ${nomeFuncionario}
                            </div>
                                <div class="info_veiculo">
                                    <div class="placa">
                                        veículo: ${placaVeiculo}
                                    </div>
                                    <div class="tipo_veiculo">
                                        caminhão: ${modeloVeiculo}
                                    </div>
                                </div>
                            </div>
                        </div>`
                    }
                })

        }
    }

    function alertaSensor() {

        fetch(`/dashboard/alertaSensor/veiculosRota/${idUsuario}`)
            .then(res => res.json())
            .then(qtdVeiculosRota => {
                if (qtdVeiculosRota.length > 0) {

                    for (let i = 0; i < qtdVeiculosRota.length; i++) {
                        var idVeiculo = qtdVeiculosRota[i].idVeiculo

                        fetch(`/dashboard/alertaSensor/infoMotorista/${idVeiculo}`)
                            .then(res => res.json())
                            .then(infoMotorista => {
                                console.log(infoMotorista)

                                var imagemPerfil_funcionario = infoMotorista[i].imagemPerfil_funcionario
                                var nomeFuncionario = infoMotorista[i].nomeFuncionario
                                var placaVeiculo = infoMotorista[i].placaVeiculo
                                var modelo = infoMotorista[i].modelo

                                div_alerta_exibirSensor.innerHTML += `
                                    <div class="notificacao-alertaSensor" id="alertaSensor_${idVeiculo}">
                                    <div class="statusSensor">
                                        <div class="bolinha_status"></div>
                                        <div class="status">
                                            ATIVO
                                        </div>
                                    </div>

                                    <div class="infoSensor1">
                                        <div class="sensor_imgFunc">
                                            <img src="assets/imagens de perfil/${imagemPerfil_funcionario}" alt="">
                                        </div>
                                        <div class="subInfoSensor">
                                            <div class="sensorNomeFunc">
                                                ${nomeFuncionario}
                                            </div>
                                            <div class="sensorVeiculo">
                                                veículo: ${placaVeiculo}
                                            </div>
                                            <div class="sensorVeiculoTipo">
                                                caminhão: ${modelo}
                                            </div>
                                        </div>
                                    </div>
                                    </div>`

                                fetch(`/dashboard/alertaSensor/defeitoSensor/${idVeiculo}`)
                                    .then(res => res.json())
                                    .then(statusSensor => {
                                        console.log(statusSensor)

                                        var div = document.getElementById(`alertaSensor_${idVeiculo}`)
                                        var mensagem = `
                                            <div class="infoSensor2" id="infoSensor2_${idVeiculo}">
                                            <div class="sensorStatus">
                                                STATUS: Exige manutenção
                                            </div>
                                            <div class="infoSensor3">
                                                <div class="subInfoSensor1">`;

                                        for (let i = 0; i < statusSensor.length; i++) {
                                            var status = statusSensor[i].statusSensor;
                                            var localizacao = statusSensor[i].localizacao;

                                            if (status == "COM DEFEITO") {
                                                mensagem += `
                                                <div style="color: red;">
                                                    ${localizacao}: DEFEITO
                                                </div>`;
                                            } else {
                                                mensagem += `
                                                <div style="color: green;">
                                                    ${localizacao}: OK
                                                </div>`;
                                            }
                                        }

                                        mensagem += `
                                            </div>
                                                    <div class="botaoChamado">
                                                        <button onclick="chamado()">chamado</button>
                                                    </div>
                                                </div>
                                            </div>`;

                                        div.innerHTML += mensagem;
                                    });
                            })

                    }
                }
            })
    }


</script>